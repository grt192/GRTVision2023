<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>HTML5 Video Tag Test</title>
    <script type="text/javascript" src="jmuxer.min.js"></script>
</head>

<body>
    hello?
    <video id="player" autoplay controls>
        Your browser does not support the video tag.
    </video>
</body>

<script>
    function parse(data) {
        var input = new Uint8Array(data),
            dv = new DataView(input.buffer),
            duration,
            video;

        duration = dv.getUint16(0, true);
        video = input.subarray(4);

        console.log(duration);

        return {
            video: video,
            duration: duration
        };
    }

    var jmuxer = new JMuxer({
        node: 'player',
        mode: 'video',
        // debug: true,
        // fps: 30,
        // flushingTime: 100,
        readFpsFromtrack: true,
    });
    // works with:
    // gst-launch-1.0 -v ksvideosrc ! videoconvert ! videoscale ! "video/x-raw,width=640,height=480,framerate=30/1" ! videoconvert ! x264enc tune=zerolatency bitrate=500 speed-preset=superfast ! queue ! udpsink port=49999 host=127.0.0.1

    const sock = new WebSocket('ws://127.0.0.1:50001');
    sock.binaryType = "arraybuffer"
    console.log(sock);
    sock.addEventListener('open', function (event) {
        sock.send('Connection Established');
    });

    sock.addEventListener('message', function (event) {
        // console.log(event.data);
        parse(event.data);
        jmuxer.feed({
            video: new Uint8Array(event.data)
        });
    });
</script>

</html>